<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duckside</title>
    <link href="css/style.css" rel="stylesheet">
    <!-- focus premium -->
    <link href="css/sidebar.css" rel="stylesheet">

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- font-awesome icon -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <script src="js/jquery.min.js"></script>
    <script src="js/popper.min.js"></script>

</head>

<style>

</style>

<body>

    <div class="sidebar sidebar-hide-to-small sidebar-shrink sidebar-gestures">
        <div class="nano">
            <div class="nano-content">
                <ul>
                    <div class="logo">
                        <a href="index.html">
                            <img src="assets/images/duck_right.png" alt="">
                            <span>Duckside</span>
                        </a>
                    </div>
                    <li><a href="about.html"><i class="fa fa-home"></i> 關於本站</a></li>
                    <li class="label">投資管理</li>
                    <li><a href="dashboard.html"><i class="fa fa-pie-chart"></i> 總覽</a></li>
                    <li><a href="chart-morris.html"><i class="fa fa-table"></i> 交易紀錄</a></li>
                    <li><a href="chartjs.html"><i class="fa fa-anchor"></i> 進出策略</a></li>
                    <li><a href="chartist.html"><i class="fa fa-bank"></i> 資產明細</a></li>
                    <li><a href="chart-peity.html"><i class="fa fa-line-chart"></i> 投資結算</a></li>
                    <li class="label">其他常用連結</li>
                    <li><a class="sidebar-sub-toggle"><i class="fa fa-briefcase"></i> 小工具<span
                                class="sidebar-collapse-icon fa fa-angle-down"></span></a>
                        <ul>
                            <li><a href="chartPieValue.html">圓餅圖: 市值</a></li>
                            <li><a href="chartPieCost.html">圓餅圖: 成本</a></li>
                            <li><a href="calculatorRRR">計算機: 風險報酬</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <!-- /# sidebar -->

    <div class="header">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">
                    <div class="float-left">
                        <div class="hamburger sidebar-toggle">
                            <span class="line"></span>
                            <span class="line"></span>
                            <span class="line"></span>
                        </div>
                    </div>
                    <div class="float-right">
                        <div class="dropdown dib">
                            <div class="header-icon" data-toggle="dropdown">
                                <i class="fa fa-bell"></i>
                                <div class="drop-down dropdown-menu dropdown-menu-right">
                                    <div class="dropdown-content-heading">
                                        <span class="text-left">Recent Notifications</span>
                                    </div>
                                    <div class="dropdown-content-body">
                                        <ul>
                                            <li>
                                                <a href="#">
                                                    <img class="pull-left m-r-10 avatar-img" src="#" alt="" />
                                                    <div class="notification-content">
                                                        <small class="notification-timestamp pull-right">02:34
                                                            PM</small>
                                                        <div class="notification-heading">Mr. John</div>
                                                        <div class="notification-text">5 members joined today </div>
                                                    </div>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#">
                                                    <img class="pull-left m-r-10 avatar-img" src="#" alt="" />
                                                    <div class="notification-content">
                                                        <small class="notification-timestamp pull-right">02:34
                                                            PM</small>
                                                        <div class="notification-heading">Mariam</div>
                                                        <div class="notification-text">likes a photo of you</div>
                                                    </div>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#">
                                                    <img class="pull-left m-r-10 avatar-img" src="#" alt="" />
                                                    <div class="notification-content">
                                                        <small class="notification-timestamp pull-right">02:34
                                                            PM</small>
                                                        <div class="notification-heading">Tasnim</div>
                                                        <div class="notification-text">Hi Teddy, Just wanted to let you ...
                                                        </div>
                                                    </div>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#">
                                                    <img class="pull-left m-r-10 avatar-img" src="#" alt="" />
                                                    <div class="notification-content">
                                                        <small class="notification-timestamp pull-right">02:34
                                                            PM</small>
                                                        <div class="notification-heading">Mr. John</div>
                                                        <div class="notification-text">Hi Teddy, Just wanted to let you ...
                                                        </div>
                                                    </div>
                                                </a>
                                            </li>
                                            <li class="text-center">
                                                <a href="#" class="more-link">See All</a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="dropdown dib">
                            <div class="header-icon" data-toggle="dropdown">
                                <i class="fa fa-envelope"></i>
                                <div class="drop-down dropdown-menu dropdown-menu-right">
                                    <div class="dropdown-content-heading">
                                        <span class="text-left">2 New Messages</span>
                                        <a href="email.html">
                                            <i class="ti-pencil-alt pull-right"></i>
                                        </a>
                                    </div>
                                    <div class="dropdown-content-body">
                                        <ul>
                                            <li class="notification-unread">
                                                <a href="#">
                                                    <img class="pull-left m-r-10 avatar-img" src="#" alt="" />
                                                    <div class="notification-content">
                                                        <small class="notification-timestamp pull-right">02:34
                                                            PM</small>
                                                        <div class="notification-heading">Michael Qin</div>
                                                        <div class="notification-text">Hi Teddy, Just wanted to let you ...
                                                        </div>
                                                    </div>
                                                </a>
                                            </li>
                                            <li class="notification-unread">
                                                <a href="#">
                                                    <img class="pull-left m-r-10 avatar-img" src="#" alt="" />
                                                    <div class="notification-content">
                                                        <small class="notification-timestamp pull-right">02:34
                                                            PM</small>
                                                        <div class="notification-heading">Mr. John</div>
                                                        <div class="notification-text">Hi Teddy, Just wanted to let you ...
                                                        </div>
                                                    </div>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#">
                                                    <img class="pull-left m-r-10 avatar-img" src="#" alt="" />
                                                    <div class="notification-content">
                                                        <small class="notification-timestamp pull-right">02:34
                                                            PM</small>
                                                        <div class="notification-heading">Michael Qin</div>
                                                        <div class="notification-text">Hi Teddy, Just wanted to let you ...
                                                        </div>
                                                    </div>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#">
                                                    <img class="pull-left m-r-10 avatar-img" src="#" alt="" />
                                                    <div class="notification-content">
                                                        <small class="notification-timestamp pull-right">02:34
                                                            PM</small>
                                                        <div class="notification-heading">Mr. John</div>
                                                        <div class="notification-text">Hi Teddy, Just wanted to let you ...
                                                        </div>
                                                    </div>
                                                </a>
                                            </li>
                                            <li class="text-center">
                                                <a href="#" class="more-link">See All</a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="dropdown dib">
                            <div class="header-icon" data-toggle="dropdown">
                                <i class="fa fa-user"></i>
                                <div class="drop-down dropdown-profile dropdown-menu dropdown-menu-right">
                                    <div class="dropdown-content-heading">
                                        <span class="text-left">Upgrade Now</span>
                                        <p class="trial-day">30 Days Trail</p>
                                    </div>
                                    <div class="dropdown-content-body">
                                        <ul>
                                            <li>
                                                <a href="#">
                                                    <i class="ti-user"></i>
                                                    <span>Profile</span>
                                                </a>
                                            </li>

                                            <li>
                                                <a href="#">
                                                    <i class="ti-email"></i>
                                                    <span>Inbox</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#">
                                                    <i class="ti-settings"></i>
                                                    <span>Setting</span>
                                                </a>
                                            </li>

                                            <li>
                                                <a href="#">
                                                    <i class="ti-lock"></i>
                                                    <span>Lock Screen</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#">
                                                    <i class="ti-power-off"></i>
                                                    <span>Logout</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /# header -->

    <div class="content-wrap">
        <div class="main">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-8 p-r-0 title-margin-right">
                        <div class="page-header">
                            <div class="page-title">
                                <h1>Hello, <span>Welcome Here</span></h1>
                            </div>
                        </div>
                    </div>
                    <!-- /# column -->
                    <div class="col-lg-4 p-l-0 title-margin-left">
                        <div class="page-header">
                            <div class="page-title">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="dashboard.html">總覽</a></li>
                                    <li class="breadcrumb-item">小工具</li>
                                    <li class="breadcrumb-item active">圓餅圖: 成本</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                    <!-- /# column -->
                </div>
                <!-- /# row -->
                <section id="main-content">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-title">
                                    <h4>第一步: 輸入當前庫存</h4>
                                </div>
                                <div class="card-body">
                                    <form action="">
                                        <div class="form-group">
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">商品名稱</span>
                                                </div>
                                                <input class="text" list="stocklist" id="stockName" type="text">
                                                <datalist id="stocklist"></datalist>
                                            </div>
                                        </div>
                                        <div class="form-group form-inline">
                                            <div class="input-group mr-sm-2 mb-2 input-group-sm">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">數量</span>
                                                </div>
                                                <input type="number" id="stockAmount" step=1000>
                                            </div>
                                            <div class="input-group mr-sm-2 mb-2 input-group-sm">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">均價</span>
                                                </div>
                                                <input type="number" id="stockAC">
                                            </div>
                                            <div class="input-group mr-sm-2 mb-2 input-group-sm">
                                                <button onclick="addAsset()" class="btn btn-secondary btn-sm" type="button" id="btnAdd">加入</button>
                                            </div>
                                        </div>
                                    </form>
                                    <div>
                                        <table class="table table-sm p-0">
                                            <thead>
                                                <tr>
                                                    <th>刪除</th>
                                                    <th>名稱</th>
                                                    <th>數量</th>
                                                    <th>均價</th>
                                                </tr>
                                            </thead>
                                            <tbody id="myAssetList">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-title">
                                    <h4>第二步: 輸入可用資金</h4>
                                </div>
                                <div class="card-body">
                                    <div class="form-group">
                                        <div class="input-group">
                                            <input class="mr-sm-2" type="number" id="myCash">
                                            <button class="btn btn-warning" onclick="myPieCost()" type="button" id="btnPie">畫餅</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-title">
                                    <h4>chartist</h4>
                                </div>
                                <div class="card-body">
                                    <div class="ct-chart-pie"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-12">
                            <div class="footer">
                                <p>2018 © Admin Board. - <a href="#">example.com</a></p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <script src="js/jquery.nanoscroller.min.js"></script>
    <!-- nanoscroller -->

    <script src="js/sidebar.js"></script>
    <script src="js/pace.min.js"></script>
    <!-- sidebar -->

    <script src="js/bootstrap.min.js"></script>

    <!-- 硬載入一份寫好的上市股票收盤資料存在datalist物件 -->
    <script type="text/javascript" src="data/MI_INDEX.json"></script>


    <script src="js/scripts.js"></script>
    <script src="js/chartist/chartist.js"></script>


    <!-- 假的總覽 -->
    <!-- <script src="js/dashboard.js"></script> -->


    <script>
        var myStockName = [];
        var myAsset = {};

        function addAsset() {
            var n = document.getElementById("stockName").value;
            var q = toFixed(parseFloat(document.getElementById("stockAmount").value));
            var p = toFixed(parseFloat(document.getElementById("stockAC").value));

            // add input value into myStockName and myAsset
            // if (myAsset[n] != undefined) {
            //     alert(`已有${n}庫存資料, 將覆寫原數量均價!`)
            // };
            myAsset += {
                "stock": n,
                "amount": q,
                "AC": p,
            };
            myAsset["cost"] = myAsset[n].amount * myAsset[n].AC;

            // print myAsset in the table below the input div
            var temp = "";
            for (var i in myAsset) {
                temp +=
                    `<tr>
                        <td><button onclick="delAsset(this)" class="btn" type="button"><i class="fa fa-trash-o"></button></i></td>
                        <td>${i}</td>
                        <td>${myAsset[i].amount}</td>
                        <td>${myAsset[i].AC}</td>
                    </tr>`;
            };
            document.getElementById("myAssetList").innerHTML = temp;

            // reset the inputs 
            document.getElementById("stockName").value = "";
            document.getElementById("stockAmount").value = null;
            document.getElementById("stockAC").value = null;
            document.getElementById("stockName").focus();
        }
        // Execute above function when the user releases a key on the keyboard
        document.getElementById("stockAC").addEventListener("keyup", function(event) {
            if (event.keyCode === 13) {
                document.getElementById("btnAdd").click();
            }
        });

        function delAsset(temp) {
            var n = temp.parentNode.nextSibling.nextSibling.innerText;
            temp.parentNode.parentNode.remove();
            delete myAsset[n];
        }

        function myPieCost() {
            var k = parseInt(document.getElementById("myCash").value);
            myAsset["現金"] = {
                    "cost": k
                }
                // calculate the proportion(pr) of each asset cost, 
                // and set the className to fill different colors by weight levels
            var totCost = 0;
            for (var i in myAsset) {
                totCost += myAsset[i].cost
            }
            console.log(`totCost= ${totCost}`);
            for (var i in myAsset) {
                var temp = Math.round(myAsset[i].cost / totCost * 100);
                myAsset[i]["pr"] = temp + '%';
                switch ((temp - temp % 10) / 10) {
                    case 0:
                        myAsset[i]["fill"] = "ct-color-lighter";
                        break;
                    case 1:
                        myAsset[i]["fill"] = "ct-color-light";
                        break;
                    case 2:
                        myAsset[i]["fill"] = "ct-color-middle";
                        break;
                    case 3:
                        myAsset[i]["fill"] = "ct-color-heavy";
                        break;
                    default:
                        myAsset[i]["fill"] = "ct-color-heavier"
                }
            }
            myAsset["現金"]["fill"] = "ct-color-lighter";
            console.log(myAsset);

            // prepare the parameter of the chartist
            var data = {
                labels: [],
                series: [],
            }
            for (var i in myAsset) {
                // data["labels"].push(`${i} ${myAsset[i].pr}`);
                data["series"].push({
                    value: myAsset[i].cost,
                    className: myAsset[i].fill,
                    labels: `${i} ${myAsset[i].pr}`
                })
            };
            console.log(data);

            // re-sort myAsset by the cost of each stock
            data["series"] = data["series"].sort(function(a, b) {
                return a.value < b.value ? 1 : -1;
            });
            for (var i in data["series"]) {
                data["labels"].push(`${data["series"][i].labels}`);
            };

            var options = {
                labelInterpolationFnc: function(value) {
                    return value;
                }
            };

            var responsiveOptions = [
                ['screen and (min-width: 640px)', {
                    chartPadding: 20,
                    labelOffset: 80,
                    labelInterpolationFnc: function(value) {
                        return value;
                    }
                }],
                ['screen and (min-width: 992px)', {
                    labelInterpolationFnc: function(value) {
                        return value;
                    },
                    chartPadding: 0,
                    labelOffset: 0,
                }],
                ['screen and (min-width: 1281px)', {
                    chartPadding: 20,
                    labelOffset: 80,
                    labelInterpolationFnc: function(value) {
                        return value;
                    }
                }]
            ];
            new Chartist.Pie('.ct-chart-pie', data, options, responsiveOptions);
        }
        // Execute above function when the user releases a key on the keyboard
        document.getElementById("myCash").addEventListener("keyup", function(event) {
            if (event.keyCode === 13) {
                document.getElementById("btnPie").click();
            }
        });
    </script>

</body>

</html>